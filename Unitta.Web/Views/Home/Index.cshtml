@model HomeViewModel

@{
    ViewData["Title"] = "Home";
}
<div class="hero-section">
    <div class="hero-overlay">
        <div class="hero-content text-center text-white">
            <h1 class="display-4 fw-bold mb-3">Your Perfect Getaway Awaits</h1>
            <p class="lead mb-4">Book your stay with us and experience luxury like never before.</p>

            <div class="booking-widget-hero">
                <div class="row g-2 align-items-center">
                    <div class="col-md">
                        <div class="form-floating">
                            <input asp-for="CheckInDate" type="text" class="form-control" placeholder="Check In" />
                            <label asp-for="CheckInDate">Check-in Date</label>
                        </div>
                    </div>
                    <div class="col-md">
                        <div class="form-floating">
                            <select asp-for="NumberOfNights" class="form-select">
                                @for (var i = 1; i <= 10; i++)
                                {
                                    <option value="@i">@i Night@(i > 1 ? "s" : "")</option>
                                }
                            </select>
                            <label asp-for="NumberOfNights">Length of Stay</label>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <button type="button" id="checkAvailabilityBtn" onclick="loadUnitList()" class="btn btn-hero-search w-100">
                            <span class="btn-icon"><i class="bi bi-search"></i></span>
                            <span class="btn-text">Availability</span>
                            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active"><img src="~/images/1.png" class="d-block w-100" alt="Slide 1"></div>
            <div class="carousel-item"><img src="~/images/2.jpg" class="d-block w-100" alt="Slide 2"></div>
            <div class="carousel-item"><img src="~/images/3.jpg" class="d-block w-100" alt="Slide 3"></div>
            <div class="carousel-item"><img src="~/images/4.jpg" class="d-block w-100" alt="Slide 4"></div>
            <div class="carousel-item"><img src="~/images/5.jpg" class="d-block w-100" alt="Slide 5"></div>
            <div class="carousel-item"><img src="~/images/6.jpg" class="d-block w-100" alt="Slide 6"></div>
            <div class="carousel-item"><img src="~/images/7.jpg" class="d-block w-100" alt="Slide 7"></div>
        </div>
    </div>
</div>

<div class="container mt-5 py-4">
    <div class="section-header-elegant text-center mb-5">
        <p class="eyebrow-text">EXPLORE OUR COLLECTION</p>
        <h2 class="display-5">Our Exclusive Units</h2>
    </div>
    <div id="unitListContainer">
        <partial name="_UnitList" model="Model" />

    </div>
</div>

@section scripts {
    <partial name="_Notification" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize Flatpickr for a single date selection
            flatpickr("#CheckInDate", {
                dateFormat: "Y-m-d",
                minDate: "today"

            });
        });

        function loadUnitList() {
            var checkInDateStr = $("#CheckInDate").val();
            var numberOfNights = $("#NumberOfNights").val();

            if (!checkInDateStr) {
                alert("Please select a check-in date.");
                return;
            }

             const btn = document.getElementById('checkAvailabilityBtn');
            const btnIcon = btn.querySelector('.btn-icon');
            const btnText = btn.querySelector('.btn-text');
            const spinner = btn.querySelector('.spinner-border');

            // Disable button and show spinner
            btn.disabled = true;
            btnIcon.classList.add('d-none');
            btnText.classList.add('d-none');
            spinner.classList.remove('d-none');
            // --- Spinner Logic Ends ---

            var objData = {
                checkInDate: checkInDateStr,
                numberOfNights: $("#NumberOfNights").val()
            };

            $.ajax({
                type: "POST",
                data: objData,
                url: "@Url.Action("GetUnitsByDate", "Home")",
                success: function (data) {
                    $("#unitListContainer").html(data);
                    document.getElementById('unitListContainer').scrollIntoView({ behavior: 'smooth' });
                },
                error: function (response) {
                    alert("An error occurred: " + response.responseText);
                },
                complete: function () {
                    // --- Spinner Logic Starts ---
                    // This always runs after success or error to reset the button
                    btn.disabled = false;
                    spinner.classList.add('d-none');
                    btnIcon.classList.remove('d-none');
                    btnText.classList.remove('d-none');
                    // --- Spinner Logic Ends ---
                }
            });
        }
    </script>
}